## tutorial

docker run --name repo alpine/git clone https://github.com/docker/getting-started.git

docker cp repo:/git/getting-started/ .

cd getting-started

docker build -t docker101tutorial .

docker run -d -p 80:80 --name docker-tutorial docker101tutorial

docker tag docker101tutorial {username}/docker101tutorial

docker push {username}/docker101tutorial



## 基本命令

```bash
docker exec <container-id> cat /data.txt
```

## 创建image

* 编写Dockerfile

* 执行build命令

  ``` bash
  docker build -t getting-start-pan .
  docker image ls #可以查询到getting-start-pan
  docker run -dp 3000:3000 getting-start-pan
  docker tag getting-start-pan pzh2467908/getting-started
  docker push pzh2467908/getting-started
  ```



## 共享文件

1. ```
   docker volume create todo-db
   docker run -dp 3000:3000 -v todo-db:/etc/todos getting-started
   docker volume inspect todo-db #查看volume存储位置
   
   ```

## container间通信

```bash
docker network create todo-app
docker run -d \
    --network todo-app --network-alias mysql \
    -v todo-mysql-data:/var/lib/mysql \  #使用volume:todo-mysql-data,并挂载到/var/lib/mysql；类似docker volume create
    -e MYSQL_ROOT_PASSWORD=secret \
    -e MYSQL_DATABASE=todos \
    mysql:5.7
```

* 如何让别的container找到mysql?使用 [nicolaka/netshoot](https://github.com/nicolaka/netshoot) container,

  * 创建nicolaka/netshoot container，并连接到mysql同一个network

  * 进入到container中，并使用DNS服务工具dig，找到mysql host的IP

    ``` bash
    docker run -it --network todo-app nicolaka/netshoot
    ```

``` bash
docker run -dp 3000:3000 \
  -w /app -v "$(pwd):/app" \ #-w:workdir, -v:volume
  --network todo-app \
  -e MYSQL_HOST=mysql \
  -e MYSQL_USER=root \
  -e MYSQL_PASSWORD=secret \
  -e MYSQL_DB=todos \
  node:12-alpine \
  sh -c "yarn install && yarn run dev"
  
  docker log <id> #查看app连接mysql过程
  docker exec -it <mysql-container-id> mysql -p todos
```



## docker compose

``` yaml
version: "3.7"

services:
  app:
    image: node:12-alpine
    command: sh -c "yarn install && yarn run dev"
    ports:
      - 3000:3000
    working_dir: /app
    volumes:
      - ./:/app
    environment:
      MYSQL_HOST: mysql
      MYSQL_USER: root
      MYSQL_PASSWORD: secret
      MYSQL_DB: todos

  mysql:
    image: mysql:5.7
    volumes:
      - todo-mysql-data:/var/lib/mysql
    environment: 
      MYSQL_ROOT_PASSWORD: secret
      MYSQL_DATABASE: todos

volumes:
  todo-mysql-data:
```

``` bash
docker-compose up -d
docker-compose logs -f
docker-compose down (--volumes)
```

```bash
sudo docker run --name myjenkins -p 8080:8080 -p 50000:50000 -P -v jenkins_data:/var/jenkins_home jenkins/jenkins:lts
sudo docker run -d -P --name openbmc bradchou/ubuntu:openbmc #docker:docker
docker run \
  -u root \
  --rm \  # 关闭时自动删此容器
  -d \  # 在后台运行容器（即“分离”模式）并输出容器ID，否则在终端窗口中输出正在运行的此容器的Docker日志
  -p 8080:8080 \  # 映射主机端口（第一个数字8080）和容器端口（后一个数字8080），用于HTTP访问
  -p 50000:50000 \  # 映射主机端口（第一个数字50000）和容器端口（后一个数字50000），用于连接Agent
  -v jenkins-data:/var/jenkins_home \  # 将Jenkins的Home目录映射到本地
  -v /var/run/docker.sock:/var/run/docker.sock \  # 允许容器与Docker守护进程通信
  jenkins/jenkins:lts
 
sudo docker exec -it myjenkins bash
sudo docker logs myjenkins
sudo docker inspect myjenkins
```

``` bash
docker run -it --rm --log-driver none jess/telnet towel.blinkenlights.nl
```

