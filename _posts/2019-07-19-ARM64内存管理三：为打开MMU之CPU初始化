2019-07-19-ARM64内存管理三：为打开MMU之CPU初始化

<上一篇中，详细分析了MMU打开前，为MMU打开后能正常启动linux kernel进行了3块区域的section map; 本篇聚焦为打开MMU而进行的CPU初始化, 主要内容：

* cache和TLB处理

* memory attributes lookup table的创建

* SCTLR_EL1、TCR_EL1的设定

## 首先介绍icache, dcache

### icache: 指令cache(instruction cache)

* 由cp15协处理器中控制寄存器1的第12位控制，一般在MMU开启之后被使用

* icache一般有512个entry，每个16 bytes；如果miss cache, 则从内存中读取指令，且触发`8-word linefill`, 将该指令所在区域8 word写进某个entry

### dcache: 数据cache

* ARM dcache架构由cache存储器和写缓冲器（write-buffer）组成，其中写缓冲器是CACHE按照FIFO原则向主存写的缓冲处理器

* 一般来说CACHEABILITY和BUFFERABILITY都是可以配置的，所以，一块存储区域可以配置成下面4种方式：NCNB CNB NCB CB(例: ip map都采用NCNB)

* DCaches使用的是虚拟地址，它的大小是16KB,它被分成512行（entry）, 每行8个字（8 words,32Bits）。每行有两个修改标志位（dirty bits），第一个标志位标识前4个字，第二个标志位标识后4个字，同时每行中还有一个TAG 地址（标签地址）和一个valid bit

